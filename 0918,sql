-- Group by: 여러 데이터에서 의미 있는 하나의 결과를 특정 열 값으로 묶어서 출력
-- 전체 평균
SELECT ROUND(AVG(SAL), 2) 
FROM EMP;

-- 부서별 평균
SELECT DEPTNO, ROUND(AVG(SAL), 2)
FROM EMP
GROUP BY DEPTNO
ORDER BY DEPTNO;

-- GROUP BY 절 없이 구현한다면?
SELECT ROUND(AVG(SAL), 2) FROM EMP WHERE DEPTNO = 10;
SELECT ROUND(AVG(SAL), 2) FROM EMP WHERE DEPTNO = 20;
SELECT ROUND(AVG(SAL), 2) FROM EMP WHERE DEPTNO = 30;

-- 집합 연산자를 사용하여 구현
SELECT AVG(SAL)FROM EMP WHERE DEPTNO = 10
UNION ALL
SELECT AVG(SAL)FROM EMP WHERE DEPTNO = 20
UNION ALL
SELECT AVG(SAL)FROM EMP WHERE DEPTNO = 30;

-- 부서코드, 급여합계, 부서 평균, 부서 코드 순 정렬
SELECT DEPTNO 부서코드, SUM(SAL) 합계, ROUND(AVG(SAL)) 평균, COUNT(*) 총인원
FROM EMP
GROUP BY DEPTNO
ORDER BY DEPTNO ASC;

-- HAVING 절: GROUP BY 절이 존재할 떄만 사용 가능
-- GROUP BY 절을 통해 그룹화된 결과 값의 번위를 제한할 때 사용
SELECT DEPTNO, JOB, ROUND(AVG(SAL),2)
FROM EMP
GROUP BY DEPTNO, JOB    -- 부서별로 묶고 거기에 직업으로 한번더 나눔
    HAVING AVG(SAL) >= 2000     -- 평균은 2000이상의 급여로 
ORDER BY DEPTNO, JOB;


